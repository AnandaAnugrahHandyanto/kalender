<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Kalender Libur Nasional</title>
<style>
    body {
        font-family: Arial, sans-serif;
        margin: 0; padding: 0;
        background-color: var(--bg-color);
        color: var(--text-color);
        transition: background 0.3s, color 0.3s;
    }
    :root {
        --bg-color: #ffffff;
        --text-color: #000000;
        --accent-color: #1a73e8;
        --holiday-color: #e53935;
    }
    body.dark {
        --bg-color: #121212;
        --text-color: #ffffff;
        --accent-color: #90caf9;
        --holiday-color: #ff8a80;
    }
    header {
        display: flex;
        flex-wrap: wrap;
        justify-content: space-between;
        align-items: center;
        padding: 10px;
        background: var(--accent-color);
        color: white;
        gap: 10px;
    }
    header h1 {
        flex: 1 1 auto;
        margin: 0;
        text-align: center;
        min-width: 180px;
    }
    .calendar {
        max-width: 600px;
        margin: auto;
        padding: 10px;
        touch-action: pan-y;
    }
    .calendar-grid {
        display: grid;
        grid-template-columns: repeat(7, 1fr);
        gap: 5px;
    }
    .calendar-grid > div {
        text-align: center;
        user-select: none;
    }
    .calendar-grid > div.header-day {
        font-weight: bold;
        font-size: 0.9rem;
        padding: 5px 0;
        border-bottom: 2px solid var(--accent-color);
    }
    .calendar-grid > div.day {
        padding: 8px 6px 4px 6px;
        border-radius: 6px;
        font-size: 1rem;
        line-height: 1.2;
        position: relative;
        cursor: default;
        transition: background 0.2s, color 0.2s;
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        min-height: 54px;
    }
    .calendar-grid > div.day.holiday {
        background: transparent;
        cursor: pointer;
        color: var(--holiday-color);
        font-weight: 700;
        /* text-decoration: underline; */
    }
    .calendar-grid > div.day.holiday > span.holiday-number {
        color: inherit;
        font-weight: inherit;
        text-decoration: inherit;
    }
    .calendar-grid > div.day:hover {
        background: var(--accent-color);
        color: white;
        cursor: pointer;
        text-decoration: none;
    }
    .calendar-grid > div.day.today {
        border: 2px solid var(--accent-color);
        font-weight: 700;
        box-shadow: 0 0 6px var(--accent-color);
        background: var(--bg-color);
        color: var(--accent-color);
        text-decoration: none;
    }
    body.dark .calendar-grid > div.day.today {
        background: #263238;
        color: var(--accent-color);
    }
    #holidayDescription {
        display: none;
        max-width: 600px;
        margin: 10px auto;
        padding: 12px 15px;
        font-size: 1rem;
        min-height: 60px;
        color: var(--text-color);
        border: 1px solid var(--accent-color);
        border-radius: 8px;
        background: var(--bg-desc, #e3f2fd);
        user-select: text;
        box-shadow: 0 4px 8px rgb(26 115 232 / 0.2);
        transition: background 0.3s, color 0.3s;
    }
    body.dark #holidayDescription {
        --bg-desc: #1e293b;
        color: #bbdefb;
        border-color: var(--accent-color);
        box-shadow: 0 4px 12px rgb(144 202 249 / 0.6);
    }
    #holidayDescription .desc-holiday {
        font-weight: 700;
        color: var(--holiday-color);
        margin-bottom: 8px;
        font-size: 1.1rem;
    }
    #holidayDescription .desc-diff {
        font-style: italic;
        color: var(--accent-color);
        font-size: 0.95rem;
    }
    .controls {
        display: flex;
        align-items: center;
        gap: 5px;
    }
    button {
        padding: 6px 12px;
        border: none;
        border-radius: 5px;
        background: var(--accent-color);
        color: white;
        cursor: pointer;
        font-size: 1rem;
        transition: background 0.3s;
    }
    button:hover {
        background: #145dbf;
    }
    input[type=number] {
        width: 80px;
        padding: 5px 8px;
        border-radius: 5px;
        border: none;
        font-size: 1rem;
        text-align: center;
    }

    /* Animasi swipe */
    @keyframes slideLeftOut {
      from { transform: translateX(0); opacity: 1; }
      to { transform: translateX(-100%); opacity: 0; }
    }
    @keyframes slideRightOut {
      from { transform: translateX(0); opacity: 1; }
      to { transform: translateX(100%); opacity: 0; }
    }
    @keyframes slideIn {
      from { transform: translateX(var(--start-pos)); opacity: 0; }
      to { transform: translateX(0); opacity: 1; }
    }
    .calendar-grid.animating {
      pointer-events: none;
    }
    .calendar-grid.slide-left-out {
      animation: slideLeftOut 0.25s forwards;
    }
    .calendar-grid.slide-right-out {
      animation: slideRightOut 0.25s forwards;
    }
    .calendar-grid.slide-in {
      animation: slideIn 0.25s forwards;
    }

    /* Style pasaran Jawa */
    .pasaran {
        font-size: 0.65rem;
        color: var(--accent-color);
        opacity: 0.6;
        margin-top: 2px;
        user-select: none;
        font-weight: 600;
        text-transform: capitalize;
    }
</style>
</head>
<body>
<header>
    <button id="prevMonth" title="Bulan sebelumnya">âŸ¨</button>
    <h1 id="monthYear"></h1>
    <button id="nextMonth" title="Bulan berikutnya">âŸ©</button>
    <div class="controls">
        <input type="number" id="yearInput" min="1900" max="2100" step="1" title="Masukkan tahun" />
        <button id="goYearBtn" title="Lihat tahun">Lihat Tahun</button>
    </div>
    <button id="toggleMode" title="Toggle mode gelap/terang">ðŸŒ™</button>
</header>
<div class="calendar">
    <div class="calendar-grid" id="calendarDays"></div>
</div>
<div id="holidayDescription"></div>

<script>
const apiKey = "AIzaSyCHdJfqVSd-1rQ1wbbp7uaJwk9Ty2iWRAE";
const calendarId = "id.indonesian#holiday@group.v.calendar.google.com";

let currentDate = new Date();
let holidays = {};
const dayNames = ["Minggu", "Senin", "Selasa", "Rabu", "Kamis", "Jumat", "Sabtu"];

const pasaranJawa = ["legi", "pahing", "pon", "wage", "kliwon"];

function getPasaranJawa(date) {
    // Referensi: 2023-01-01 adalah "Legi" (index 0)
    const refDate = new Date(2023, 0, 1);
    const diffTime = date.getTime() - refDate.getTime();
    const diffDays = Math.floor(diffTime / (1000 * 60 * 60 * 24));
    let index = diffDays % 5;
    if (index < 0) index += 5; // agar positif
    return pasaranJawa[index];
}

async function fetchHolidays(year) {
    const timeMin = `${year}-01-01T00:00:00Z`;
    const timeMax = `${year}-12-31T23:59:59Z`;
    const url = `https://www.googleapis.com/calendar/v3/calendars/${encodeURIComponent(calendarId)}/events?key=${apiKey}&timeMin=${timeMin}&timeMax=${timeMax}&singleEvents=true&orderBy=startTime`;
    const res = await fetch(url);
    const data = await res.json();
    holidays = {};
    if (data.items) {
        data.items.forEach(event => {
            const date = event.start.date;
            holidays[date] = event.summary;
        });
    }
}

function renderCalendar() {
    const monthYear = document.getElementById("monthYear");
    const calendarDays = document.getElementById("calendarDays");
    calendarDays.innerHTML = "";

    const year = currentDate.getFullYear();
    const month = currentDate.getMonth();
    const firstDay = new Date(year, month, 1).getDay();
    const daysInMonth = new Date(year, month + 1, 0).getDate();

    monthYear.textContent = currentDate.toLocaleString("id-ID", { month: "long", year: "numeric" });

    // Header nama hari
    dayNames.forEach(day => {
        calendarDays.innerHTML += `<div class="header-day">${day}</div>`;
    });

    // Kosongkan sebelum tanggal 1
    for (let i = 0; i < firstDay; i++) {
        calendarDays.innerHTML += `<div></div>`;
    }

    const today = new Date();

    // Tanggal, libur, dan pasaran
    for (let day = 1; day <= daysInMonth; day++) {
        const dateStr = `${year}-${String(month + 1).padStart(2, "0")}-${String(day).padStart(2, "0")}`;
        const dateObj = new Date(year, month, day);
        const isSunday = dateObj.getDay() === 0;
        const isHoliday = holidays[dateStr];
        const isToday = (year === today.getFullYear() && month === today.getMonth() && day === today.getDate());

        const holidayClass = (isSunday || isHoliday) ? "holiday" : "";
        const todayClass = isToday ? "today" : "";

        const classes = [holidayClass, todayClass].filter(Boolean).join(" ");

        const pasaran = getPasaranJawa(dateObj);

        const dayNumber = day;
        calendarDays.innerHTML += `
            <div class="day ${classes}" data-date="${dateStr}" data-desc="${isHoliday ? holidays[dateStr] : ''}">
                <div>${dayNumber}</div>
                <div class="pasaran">${pasaran}</div>
            </div>
        `;
    }

    addHolidayClickListeners();
}

function addHolidayClickListeners() {
    const holidayDesc = document.getElementById("holidayDescription");
    const today = new Date();
    today.setHours(0,0,0,0);

    document.querySelectorAll(".calendar-grid > div.day").forEach(dayEl => {
        dayEl.addEventListener("click", () => {
            const desc = dayEl.getAttribute("data-desc");
            const dateStr = dayEl.getAttribute("data-date");

            if (!dateStr) {
                holidayDesc.style.display = "none";
                return;
            }

            const clickedDate = new Date(dateStr);
            clickedDate.setHours(0,0,0,0);

            const diffTime = clickedDate.getTime() - today.getTime();
            const diffDays = Math.round(diffTime / (1000 * 60 * 60 * 24));

            let diffText = "";
            if (diffDays > 0) {
                diffText = `${diffDays} hari lagi dari hari ini.`;
            } else if (diffDays === 0) {
                diffText = "Hari ini.";
            } else {
                diffText = `${Math.abs(diffDays)} hari yang lalu.`;
            }

            let holidayHTML = desc ? `<p class="desc-holiday">${desc}</p>` : `<p class="desc-holiday">Tidak ada hari libur pada tanggal ini.</p>`;
            let diffHTML = `<p class="desc-diff">${diffText}</p>`;

            holidayDesc.innerHTML = `${holidayHTML}${diffHTML}`;
            holidayDesc.style.display = "block";
        });
    });
}

document.getElementById("prevMonth").addEventListener("click", () => {
    animateSlide('right');
});
document.getElementById("nextMonth").addEventListener("click", () => {
    animateSlide('left');
});
document.getElementById("toggleMode").addEventListener("click", () => {
    document.body.classList.toggle("dark");
});
document.getElementById("goYearBtn").addEventListener("click", () => {
    const inputYear = parseInt(document.getElementById("yearInput").value);
    if (inputYear >= 1900 && inputYear <= 2100) {
        currentDate.setFullYear(inputYear);
        currentDate.setMonth(0);
        checkAndRender();
    } else {
        alert("Masukkan tahun antara 1900 sampai 2100.");
    }
});

let touchStartX = 0;
let touchEndX = 0;

const calendarGrid = document.getElementById("calendarDays");

calendarGrid.addEventListener("touchstart", (e) => {
    touchStartX = e.changedTouches[0].screenX;
}, {passive: true});

calendarGrid.addEventListener("touchend", (e) => {
    touchEndX = e.changedTouches[0].screenX;
    handleSwipeGesture();
}, {passive: true});

function handleSwipeGesture() {
    const swipeDistance = touchEndX - touchStartX;
    const minSwipeDistance = 40;

    if (swipeDistance > minSwipeDistance) {
        animateSlide('right');
    } else if (swipeDistance < -minSwipeDistance) {
        animateSlide('left');
    }
}

function animateSlide(direction) {
    calendarGrid.classList.add("animating");

    if (direction === "left") {
        calendarGrid.classList.add("slide-left-out");
    } else {
        calendarGrid.classList.add("slide-right-out");
    }

    calendarGrid.addEventListener("animationend", function handler() {
        calendarGrid.removeEventListener("animationend", handler);

        if (direction === "left") {
            currentDate.setMonth(currentDate.getMonth() + 1);
        } else {
            currentDate.setMonth(currentDate.getMonth() - 1);
        }

        checkAndRender().then(() => {
            calendarGrid.style.setProperty('--start-pos', direction === 'left' ? '100%' : '-100%');
            calendarGrid.classList.remove("slide-left-out", "slide-right-out");
            calendarGrid.classList.add("slide-in");

            calendarGrid.addEventListener("animationend", function handlerIn() {
                calendarGrid.removeEventListener("animationend", handlerIn);
                calendarGrid.classList.remove("slide-in", "animating");
                calendarGrid.style.removeProperty('--start-pos');
            });
        });
    });
}

document.getElementById("yearInput").value = currentDate.getFullYear();

async function checkAndRender() {
    const year = currentDate.getFullYear();
    await fetchHolidays(year);
    renderCalendar();
}

checkAndRender();
</script>
</body>
</html>
