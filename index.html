<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Kalender Libur Nasional - Tailwind CSS</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>

      /* Sembunyikan spinner input angka */
      input[type="number"]::-webkit-outer-spin-button,
      input[type="number"]::-webkit-inner-spin-button {
        -webkit-appearance: none;
        margin: 0;
      }
      input[type="number"] {
        -moz-appearance: textfield;
      }
      
      /* Animasi Keyframe untuk transisi bulan kalender */
      @keyframes slide-out-left { from { transform: translateX(0); opacity: 1; } to { transform: translateX(-100%); opacity: 0; } }
      @keyframes slide-in-from-right { from { transform: translateX(100%); opacity: 0; } to { transform: translateX(0); opacity: 1; } }
      @keyframes slide-out-right { from { transform: translateX(0); opacity: 1; } to { transform: translateX(100%); opacity: 0; } }
      @keyframes slide-in-from-left { from { transform: translateX(-100%); opacity: 0; } to { transform: translateX(0); opacity: 1; } }

      .slide-out-left { animation: slide-out-left 0.25s ease-out forwards; }
      .slide-in-from-right { animation: slide-in-from-right 0.25s ease-out forwards; }
      .slide-out-right { animation: slide-out-right 0.25s ease-out forwards; }
      .slide-in-from-left { animation: slide-in-from-left 0.25s ease-out forwards; }
    </style>
</head>
<body class="bg-[--bg-color] text-[--text-color] transition-colors duration-300 overflow-x-hidden pb-[50px]">

<header class="bg-[--bg-color-light] px-4 py-3 select-none border-b border-[--border-color]">
  <div class="top-row flex items-center justify-between">
    <button id="prevMonth" class="month-btn flex items-center justify-center w-[38px] h-[38px] bg-transparent text-[--text-color] border border-[--border-color] rounded-full text-2xl font-bold cursor-pointer transition-all duration-200 active:scale-95 hover:border-[--accent-color] hover:bg-white/5" aria-label="Bulan sebelumnya">⟨</button>
    <div class="month-title flex-1 text-center text-xl md:text-2xl font-semibold text-[--accent-color]" id="monthYear" aria-live="polite" aria-atomic="true">Loading...</div>
    <button id="nextMonth" class="month-btn flex items-center justify-center w-[38px] h-[38px] bg-transparent text-[--text-color] border border-[--border-color] rounded-full text-2xl font-bold cursor-pointer transition-all duration-200 active:scale-95 hover:border-[--accent-color] hover:bg-white/5" aria-label="Bulan berikutnya">⟩</button>
  </div>
  <div class="bottom-row mt-3 flex justify-center items-center gap-2">
    <input type="number" id="yearInput" min="1900" max="2100" aria-label="Masukkan tahun" class="w-[75px] p-1.5 rounded-lg border border-[--border-color] bg-[#333] text-[--text-color] text-center text-base" />
    <button id="goYearBtn" class="control-btn px-3 py-1.5 border-none rounded-lg bg-[--accent-color] text-white cursor-pointer text-sm font-bold transition-all duration-200 active:scale-95">Go</button>
    <button id="resetBtn" class="control-btn px-3 py-1.5 border-none rounded-lg bg-[#444] text-[--text-color] cursor-pointer text-sm font-bold transition-all duration-200 active:scale-95 hover:bg-[#555]">Hari Ini</button>
  </div>
</header>

<div class="calendar max-w-[600px] mx-auto my-4 px-2.5 touch-pan-y relative overflow-hidden min-h-[320px]" role="grid" aria-label="Kalender libur nasional">
  <div class="calendar-grid grid grid-cols-7 gap-1.5" id="calendarDays"></div>
</div>

<div id="holidayDescription" role="region" aria-live="polite" aria-atomic="true" style="display:none;" class="max-w-[600px] mx-auto my-3 md:my-5 p-4 rounded-xl bg-[--bg-color-light] text-[--text-color] border border-[--border-color] transition-opacity duration-300"></div>

<button id="menuToggle" aria-label="Toggle Menu" aria-expanded="false" class="group fixed right-4 bottom-5 md:right-5 md:bottom-5 z-[1001] w-14 h-14 bg-[--accent-color] border-none rounded-full cursor-pointer shadow-lg shadow-black/40 flex items-center justify-center transition-all duration-300 ease-[cubic-bezier(.2,.9,.3,1)] hover:scale-105 hover:rotate-15 [&.open]:scale-105 [&.open]:rotate-0 [&.open]:bg-[#555]">
  <div class="bar relative w-[26px] h-0.5 bg-white rounded-full transition-all duration-200 group-[.open]:bg-transparent before:content-[''] before:absolute before:w-full before:h-full before:bg-white before:rounded-full before:transition-all before:duration-200 before:-translate-y-2 group-[.open]:before:translate-y-0 group-[.open]:before:rotate-45 after:content-[''] after:absolute after:w-full after:h-full after:bg-white after:rounded-full after:transition-all after:duration-200 after:translate-y-2 group-[.open]:after:translate-y-0 group-[.open]:after:-rotate-45">
  </div>
</button>

<div id="menuPanel" aria-hidden="true" class="fixed bottom-[88px] right-5 w-[280px] max-w-[90vw] bg-black/50 backdrop-blur-xl backdrop-saturate-150 border border-white/10 rounded-2xl p-3 shadow-2xl shadow-black/50 z-[1000] flex flex-col gap-2 opacity-0 pointer-events-none transition-all duration-300 ease-[cubic-bezier(0.2,1,0.3,1)] transform translate-y-5 scale-95 [&.open]:opacity-100 [&.open]:pointer-events-auto [&.open]:translate-y-0 [&.open]:scale-100">
    <div class="menu-item flex items-center p-2.5 rounded-xl">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" class="w-[22px] h-[22px] mr-4 shrink-0 fill-gray-200"><path d="M20,11V8H4V11H20M20,13H4V16H20V13M18.5,4H17.5V2H15.5V4H8.5V2H6.5V4H5.5A1.5,1.5 0 0,0 4,5.5V18.5A1.5,1.5 0 0,0 5.5,20H18.5A1.5,1.5 0 0,0 20,18.5V5.5A1.5,1.5 0 0,0 18.5,4Z" /></svg>
        <span class="flex-grow text-gray-100 font-medium">Libur Nasional</span>
        <label class="toggle-switch relative inline-block w-11 h-6 shrink-0 cursor-pointer">
            <input type="checkbox" id="filterHoliday" class="opacity-0 w-0 h-0 peer" checked />
            <span class="slider absolute inset-0 bg-white/20 transition-all duration-300 rounded-full before:absolute before:content-[''] before:h-[18px] before:w-[18px] before:left-1 before:bottom-1 before:bg-white before:transition-all before:duration-300 before:ease-[cubic-bezier(0.2,1,0.3,1)] before:rounded-full peer-checked:bg-[--accent-color] peer-checked:before:translate-x-5"></span>
        </label>
    </div>
    <div class="menu-item flex items-center p-2.5 rounded-xl">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" class="w-[22px] h-[22px] mr-4 shrink-0 fill-gray-200"><path d="M19,19H5V8H19M16,1V3H8V1H6V3H5C3.89,3 3,3.89 3,5V19A2,2 0 0,0 5,21H19A2,2 0 0,0 21,19V5C21,3.89 20.1,3 19,3H18V1M17,12H12V17H17V12Z" /></svg>
        <span class="flex-grow text-gray-100 font-medium">Acara Anda</span>
        <label class="toggle-switch relative inline-block w-11 h-6 shrink-0 cursor-pointer">
            <input type="checkbox" id="filterManual" class="opacity-0 w-0 h-0 peer" checked />
            <span class="slider absolute inset-0 bg-white/20 transition-all duration-300 rounded-full before:absolute before:content-[''] before:h-[18px] before:w-[18px] before:left-1 before:bottom-1 before:bg-white before:transition-all before:duration-300 before:ease-[cubic-bezier(0.2,1,0.3,1)] before:rounded-full peer-checked:bg-[--accent-color] peer-checked:before:translate-x-5"></span>
        </label>
    </div>
    <div id="themeMenuItem" class="menu-item flex items-center p-2.5 rounded-xl transition-all duration-200 cursor-pointer hover:bg-white/10 active:scale-[0.97]">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" class="w-[22px] h-[22px] mr-4 shrink-0 fill-gray-200"><path d="M17.5,12A1.5,1.5 0 0,1 16,10.5A1.5,1.5 0 0,1 17.5,9A1.5,1.5 0 0,1 19,10.5A1.5,1.5 0 0,1 17.5,12M14.5,8A1.5,1.5 0 0,1 13,6.5A1.5,1.5 0 0,1 14.5,5A1.5,1.5 0 0,1 16,6.5A1.5,1.5 0 0,1 14.5,8M9.5,8A1.5,1.5 0 0,1 8,6.5A1.5,1.5 0 0,1 9.5,5A1.5,1.5 0 0,1 11,6.5A1.5,1.5 0 0,1 9.5,8M6.5,12A1.5,1.5 0 0,1 5,10.5A1.5,1.5 0 0,1 6.5,9A1.5,1.5 0 0,1 8,10.5A1.5,1.5 0 0,1 6.5,12M12,3A9,9 0 0,0 3,12A9,9 0 0,0 12,21A9,9 0 0,0 21,12A9,9 0 0,0 12,3Z" /></svg>
        <span class="flex-grow text-gray-100 font-medium">Tema Warna</span>
        <span id="currentThemeText" class="text-[--accent-color] font-bold mr-2">Biru</span>
        <svg class="chevron-icon w-[18px] h-[18px] fill-gray-500" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M8.59,16.58L13.17,12L8.59,7.41L10,6L16,12L10,18L8.59,16.58Z"/></svg>
    </div>
    <div id="viewEventsBtn" class="menu-item flex items-center p-2.5 rounded-xl transition-all duration-200 cursor-pointer hover:bg-white/10 active:scale-[0.97]">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" class="w-[22px] h-[22px] mr-4 shrink-0 fill-gray-200"><path d="M9,5V9H21V5M9,19H21V15H9M9,14H21V10H9M4,9H8V5H4M4,19H8V15H4M4,14H8V10H4V14Z" /></svg>
        <span class="flex-grow text-gray-100 font-medium">Daftar Acara</span>
    </div>
    <button id="addEventBtn" class="mt-2 flex items-center justify-center gap-2.5 w-full py-3 bg-[--accent-color] text-white border-none rounded-xl font-bold text-base cursor-pointer shadow-lg shadow-black/20 transition-all duration-200 ease-in-out hover:-translate-y-0.5 hover:shadow-lg hover:shadow-[--accent-color]/30">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" class="w-5 h-5 fill-white"><path d="M19,13H13V19H11V13H5V11H11V5H13V11H19V13Z"/></svg>
        <span>Tambah Acara</span>
    </button>
</div>

<div id="eventModal" class="modal-overlay fixed inset-0 z-[1100] bg-black/70 backdrop-blur-md justify-center items-center hidden [&.active]:flex transition-opacity duration-300">
    <div class="modal-content bg-[--bg-color-light] text-white p-6 rounded-2xl w-[90%] max-w-sm box-border relative border border-[--border-color] opacity-0 scale-95 transition-all duration-300 ease-[cubic-bezier(0.2,1,0.3,1)] [.active_&]:opacity-100 [.active_&]:scale-100">
        <span class="close-btn absolute right-4 top-4 text-3xl cursor-pointer text-gray-500 hover:text-white transition-colors duration-200" role="button" aria-label="Tutup">&times;</span>
        <h2 id="modalTitle" class="mb-4 text-xl font-semibold">Tambah Acara Anda</h2>
        <form id="eventForm">
            <label for="eventDate" class="block mt-4 text-sm text-gray-400">Tanggal:</label>
            <input type="date" id="eventDate" name="eventDate" required class="w-full p-3 mt-2 rounded-lg border border-[--border-color] bg-[#333] text-white box-border text-base transition-all duration-200 focus:outline-none focus:border-[--accent-color] focus:ring-2 focus:ring-[--accent-color]/40" />
            <label for="eventTime" class="block mt-4 text-sm text-gray-400">Waktu (opsional):</label>
            <input type="time" id="eventTime" name="eventTime" class="w-full p-3 mt-2 rounded-lg border border-[--border-color] bg-[#333] text-white box-border text-base transition-all duration-200 focus:outline-none focus:border-[--accent-color] focus:ring-2 focus:ring-[--accent-color]/40" />
            <label for="eventTitle" class="block mt-4 text-sm text-gray-400">Judul Acara:</label>
            <input type="text" id="eventTitle" name="eventTitle" required placeholder="Cth: Ulang tahun teman" class="w-full p-3 mt-2 rounded-lg border border-[--border-color] bg-[#333] text-white box-border text-base transition-all duration-200 focus:outline-none focus:border-[--accent-color] focus:ring-2 focus:ring-[--accent-color]/40" />
            <label for="eventDesc" class="block mt-4 text-sm text-gray-400">Deskripsi (opsional):</label>
            <textarea id="eventDesc" name="eventDesc" placeholder="Detail acara..." class="w-full p-3 mt-2 rounded-lg border border-[--border-color] bg-[#333] text-white box-border text-base transition-all duration-200 focus:outline-none focus:border-[--accent-color] focus:ring-2 focus:ring-[--accent-color]/40 resize-y min-h-[80px]"></textarea>
            
            <div id="formReminderRow" class="form-reminder-row flex justify-between items-center mt-5 p-2.5 bg-white/5 rounded-lg transition-opacity [&.disabled]:opacity-50 [&.disabled]:pointer-events-none">
                <label for="eventReminder" class="m-0 text-[--text-color]">Aktifkan Pengingat</label>
                <label class="toggle-switch relative inline-block w-11 h-6 shrink-0 cursor-pointer">
                    <input type="checkbox" id="eventReminder" class="opacity-0 w-0 h-0 peer" />
                    <span class="slider absolute inset-0 bg-white/20 transition-all duration-300 rounded-full before:absolute before:content-[''] before:h-[18px] before:w-[18px] before:left-1 before:bottom-1 before:bg-white before:transition-all before:duration-300 before:ease-[cubic-bezier(0.2,1,0.3,1)] before:rounded-full peer-checked:bg-[--accent-color] peer-checked:before:translate-x-5"></span>
                </label>
            </div>
            
            <button type="submit" class="w-full mt-6 bg-[--accent-color] border-none text-white p-3 font-bold rounded-lg cursor-pointer text-base">Simpan Acara</button>
        </form>
    </div>
</div>

<div id="themeModal" class="modal-overlay fixed inset-0 z-[1100] bg-black/70 backdrop-blur-md justify-center items-center hidden [&.active]:flex transition-opacity duration-300">
    <div class="modal-content bg-[--bg-color-light] text-white p-6 rounded-2xl w-[90%] max-w-sm box-border relative border border-[--border-color] opacity-0 scale-95 transition-all duration-300 ease-[cubic-bezier(0.2,1,0.3,1)] [.active_&]:opacity-100 [.active_&]:scale-100">
        <span class="close-btn absolute right-4 top-4 text-3xl cursor-pointer text-gray-500 hover:text-white transition-colors duration-200" role="button" aria-label="Tutup">&times;</span>
        <h2 class="mb-4 text-xl font-semibold">Pilih Tema Warna</h2>
        <div class="theme-options-grid grid grid-cols-[repeat(auto-fit,minmax(100px,1fr))] gap-4 mt-5">
            <div class="theme-option relative flex flex-col items-center gap-2.5 p-4 rounded-xl border-2 border-[#555] cursor-pointer transition-all duration-200 hover:bg-white/10 hover:-translate-y-1 [&.selected]:border-[--accent-color] [&.selected]:bg-[--accent-color]/10" data-theme="theme-blue" data-name="Biru">
                <svg class="checkmark-icon absolute top-1.5 right-1.5 w-5 h-5 text-[--accent-color] bg-white/90 rounded-full p-0.5 hidden [&.selected]:block" viewBox="0 0 24 24"><path fill="currentColor" d="M9,16.17L4.83,12l-1.42,1.41L9,19 21,7l-1.41-1.41L9,16.17z"></path></svg>
                <div class="color-swatch w-12 h-12 rounded-full border-2 border-white/70 shadow-md" style="background: linear-gradient(45deg, #90caf9, #64b5f6);"></div>
                <span>Biru</span>
            </div>
            <div class="theme-option relative flex flex-col items-center gap-2.5 p-4 rounded-xl border-2 border-[#555] cursor-pointer transition-all duration-200 hover:bg-white/10 hover:-translate-y-1 [&.selected]:border-[--accent-color] [&.selected]:bg-[--accent-color]/10" data-theme="theme-green" data-name="Hijau">
                <svg class="checkmark-icon absolute top-1.5 right-1.5 w-5 h-5 text-[--accent-color] bg-white/90 rounded-full p-0.5 hidden [&.selected]:block" viewBox="0 0 24 24"><path fill="currentColor" d="M9,16.17L4.83,12l-1.42,1.41L9,19 21,7l-1.41-1.41L9,16.17z"></path></svg>
                <div class="color-swatch w-12 h-12 rounded-full border-2 border-white/70 shadow-md" style="background: linear-gradient(45deg, #81c784, #66bb6a);"></div>
                <span>Hijau</span>
            </div>
            <div class="theme-option relative flex flex-col items-center gap-2.5 p-4 rounded-xl border-2 border-[#555] cursor-pointer transition-all duration-200 hover:bg-white/10 hover:-translate-y-1 [&.selected]:border-[--accent-color] [&.selected]:bg-[--accent-color]/10" data-theme="theme-purple" data-name="Ungu">
                <svg class="checkmark-icon absolute top-1.5 right-1.5 w-5 h-5 text-[--accent-color] bg-white/90 rounded-full p-0.5 hidden [&.selected]:block" viewBox="0 0 24 24"><path fill="currentColor" d="M9,16.17L4.83,12l-1.42,1.41L9,19 21,7l-1.41-1.41L9,16.17z"></path></svg>
                <div class="color-swatch w-12 h-12 rounded-full border-2 border-white/70 shadow-md" style="background: linear-gradient(45deg, #ba68c8, #ab47bc);"></div>
                <span>Ungu</span>
            </div>
        </div>
    </div>
</div>

<div id="eventListModal" class="modal-overlay fixed inset-0 z-[1100] bg-black/70 backdrop-blur-md justify-center items-center hidden [&.active]:flex transition-opacity duration-300">
    <div class="modal-content bg-[--bg-color-light] text-white p-6 rounded-2xl w-[90%] max-w-lg box-border relative border border-[--border-color] opacity-0 scale-95 transition-all duration-300 ease-[cubic-bezier(0.2,1,0.3,1)] [.active_&]:opacity-100 [.active_&]:scale-100">
      <span class="close-btn absolute right-4 top-4 text-3xl cursor-pointer text-gray-500 hover:text-white transition-colors duration-200" role="button" aria-label="Tutup">&times;</span>
      <h2 class="mb-4 text-xl font-semibold">Daftar Acara Anda</h2>
      <div id="eventListContainer" class="max-h-[60vh] overflow-y-auto mt-4 pr-2"></div>
    </div>
</div>

<div id="confirmModal" class="modal-overlay fixed inset-0 z-[1200] bg-black/70 backdrop-blur-md justify-center items-center hidden [&.active]:flex transition-opacity duration-300">
    <div class="modal-content bg-[--bg-color-light] text-white p-6 rounded-2xl w-[90%] max-w-xs box-border relative border border-[--border-color] opacity-0 scale-95 transition-all duration-300 ease-[cubic-bezier(0.2,1,0.3,1)] [.active_&]:opacity-100 [.active_&]:scale-100">
        <p id="confirmMessage" class="m-0 mb-6 text-lg leading-relaxed text-center"></p>
        <div class="confirm-actions flex gap-3">
            <button id="confirmBtnNo" class="flex-1 p-2.5 rounded-lg border-none font-bold text-base cursor-pointer transition-opacity hover:opacity-85 bg-[#555] text-white">Batal</button>
            <button id="confirmBtnYes" class="flex-1 p-2.5 rounded-lg border-none font-bold text-base cursor-pointer transition-opacity hover:opacity-85 bg-[--danger-color] text-white">Ya, Hapus</button>
        </div>
    </div>
</div>

<div id="toast" class="fixed bottom-20 left-1/2 -translate-x-1/2 bg-[#222] text-white px-5 py-3 rounded-lg pointer-events-none transition-all duration-300 font-bold z-[1200] border border-[--border-color] shadow-2xl shadow-black/40 opacity-0 translate-y-4 [&.show]:opacity-100 [&.show]:pointer-events-auto [&.show]:translate-y-0"></div>

<footer id="copyright-footer" class="text-center p-5 mt-5 text-sm text-gray-500"></footer>

<script>
  // NOTE: Jika data libur nasional tidak muncul, kemungkinan besar kunci API di bawah ini sudah tidak aktif.
  // Ganti dengan kunci API Google Calendar Anda sendiri untuk memperbaikinya.
  const apiKey = "AIzaSyCHdJfqVSd-1rQ1wbbp7uaJwk9Ty2iWRAE"; 
  const calendarId = "id.indonesian#holiday@group.v.calendar.google.com";
  const dayNames = ["MIN","SEN","SEL","RAB","KAM","JUM","SAB"];
  const pasaranJawa = ["Legi","Pahing","Pon","Wage","Kliwon"];
  let currentDate = new Date();
  let holidays = {};
  let manualEvents = {};
  let selectedDateStr = null;
  let isAnimating = false;

  // DOM Elements
  const calendarContainer = document.querySelector(".calendar");
  const holidayDesc = document.getElementById("holidayDescription");
  const calendarGrid = document.getElementById("calendarDays");
  const filterHoliday = document.getElementById("filterHoliday");
  const filterManual = document.getElementById("filterManual");
  const menuToggle = document.getElementById("menuToggle");
  const menuPanel = document.getElementById("menuPanel");
  const addEventBtn = document.getElementById("addEventBtn");
  const eventModal = document.getElementById("eventModal");
  const eventForm = document.getElementById("eventForm");
  const modalTitle = document.getElementById("modalTitle");
  const toast = document.getElementById("toast");
  const themeModal = document.getElementById("themeModal");
  const themeMenuItem = document.getElementById("themeMenuItem");
  const currentThemeText = document.getElementById("currentThemeText");
  const viewEventsBtn = document.getElementById("viewEventsBtn");
  const eventListModal = document.getElementById("eventListModal");
  const eventListContainer = document.getElementById("eventListContainer");
  const confirmModal = document.getElementById("confirmModal");
  const formReminderRow = document.getElementById("formReminderRow");
  const eventReminder = document.getElementById("eventReminder");
  const eventTimeInput = document.getElementById("eventTime");
  
  // SVGs for action buttons
  const editIconSVG = `<svg xmlns="http://www.w3.org/2000/svg" class="w-[18px] h-[18px] transition-colors fill-current group-hover:fill-[--warning-color]" viewBox="0 0 24 24"><path d="M20.71,7.04C21.1,6.65 21.1,6 20.71,5.63L18.37,3.29C18,2.9 17.35,2.9 16.96,3.29L15.13,5.12L18.88,8.87M3,17.25V21H6.75L17.81,9.94L14.06,6.19L3,17.25Z" /></svg>`;
  const deleteIconSVG = `<svg xmlns="http://www.w3.org/2000/svg" class="w-[18px] h-[18px] transition-colors fill-current group-hover:fill-[--danger-color]" viewBox="0 0 24 24"><path d="M9,3V4H4V6H5V19C5,20.1 5.9,21 7,21H17C18.1,21 19,20.1 19,19V6H20V4H15V3H9M7,6H17V19H7V6M9,8V17H11V8H9M13,8V17H15V8H13Z" /></svg>`;
  const reminderIconSVG = `<svg xmlns="http://www.w3.org/2000/svg" class="w-[18px] h-[18px] transition-colors fill-current group-hover:fill-[--info-color] [.active_&]:fill-[--info-color]" viewBox="0 0 24 24"><path d="M12,22A2,2 0 0,0 14,20H10A2,2 0 0,0 12,22M18,16.5V11C18,7.93 16.36,5.36 13.5,4.68V4A1.5,1.5 0 0,0 12,2.5A1.5,1.5 0 0,0 10.5,4V4.68C7.63,5.36 6,7.93 6,11V16.5L4,18V19H20V18L18,16.5Z"/></svg>`;
  const reminderOffIconSVG = `<svg xmlns="http://www.w3.org/2000/svg" class="w-[18px] h-[18px] transition-colors fill-current group-hover:fill-[--info-color]" viewBox="0 0 24 24"><path d="M2.76,3.87L1.49,5.14L6,9.65V11C6,7.93 7.64,5.36 10.5,4.68V4A1.5,1.5 0 0,1 12,2.5A1.5,1.5 0 0,1 13.5,4V4.68C14.1,4.82 14.67,5.03 15.2,5.3L18.87,8.96L20.14,7.69L19.29,6.84C19.29,6.84 19.3,6.85 19.3,6.85L18.6,6.14L19.29,6.85L21,5.14L19.86,4L18,5.86L17.41,5.27C15.63,3.87 13.43,3.06 11,3.06C8.24,3.06 5.8,4.12 4.14,5.77L2.76,3.87M18,16.5V11.82L12.18,6L11.5,6.68L9.82,5C9.2,4.43 8.44,4 7.5,4C7.38,4 7.25,4 7.13,4.03C6.1,4.5 5.2,5.27 4.58,6.2L6.17,7.79C6.54,7.2 7,6.76 7.5,6.46V6.44L16,14.94V16.5L18,18V19H7.82L9.82,21H10A2,2 0 0,0 12,22A2,2 0 0,0 14,20H18.18L20.73,22.55L22,21.28L4,3.55L2.73,2.28L4,3.55M16.5,18L4.5,6L3.23,4.73L2,6L4,8V16.5L2,18V19H14.18L12.18,17H4.5V16H11.18L16,11.18V8.5L14.5,7L13,8.5L11.5,7L10,8.5L8.5,7L7,8.5L5.5,7L4.5,8L6.5,10H6.5L14.5,18H16.5Z"/></svg>`;

  function getPasaranJawa(date) {
    const refDate = new Date(2023, 0, 1);
    const diffDays = Math.floor((date - refDate) / (1000 * 60 * 60 * 24));
    return pasaranJawa[(diffDays % 5 + 5) % 5];
  }

  async function fetchHolidays(year) {
    const timeMin = `${year}-01-01T00:00:00Z`;
    const timeMax = `${year}-12-31T23:59:59Z`;
    const url = `https://www.googleapis.com/calendar/v3/calendars/${encodeURIComponent(calendarId)}/events?key=${apiKey}&timeMin=${timeMin}&timeMax=${timeMax}&singleEvents=true&orderBy=startTime`;
    try {
      const res = await fetch(url);
      if (!res.ok) throw new Error(`API request failed with status ${res.status}`);
      const data = await res.json();
      holidays = {};
      if (data.items) {
        data.items.forEach(event => { holidays[event.start.date] = event.summary; });
      }
      holidays._year = year;
    } catch (e) {
        console.error("Gagal mengambil data libur:", e);
        showToast("Gagal memuat data libur.");
    }
  }

  function formatDateDMY(dateStr) {
    if (!dateStr) return '';
    const date = new Date(dateStr);
    date.setUTCHours(12);
    return date.toLocaleDateString('id-ID', { day: 'numeric', month: 'long', year: 'numeric' });
  }

  function daysDifference(dateStr) {
    const today = new Date(); today.setHours(0,0,0,0);
    const targetDate = new Date(dateStr); targetDate.setHours(0,0,0,0);
    return Math.round((targetDate - today) / (1000 * 60 * 60 * 24));
  }
  
  function renderCalendar() {
    calendarGrid.innerHTML = "";
    const year = currentDate.getFullYear();
    const month = currentDate.getMonth();

    document.getElementById("monthYear").textContent = currentDate.toLocaleString("id-ID", { month: "long", year: "numeric" });
    document.getElementById("yearInput").value = year;

    dayNames.forEach(d => { calendarGrid.innerHTML += `<div class="header-day text-center font-semibold text-xs py-2 text-[--text-color-muted]">${d}</div>`; });
    const firstDay = new Date(year, month, 1).getDay();
    const daysInMonth = new Date(year, month + 1, 0).getDate();
    for (let i = 0; i < firstDay; i++) { calendarGrid.innerHTML += `<div></div>`; }
    const today = new Date(); today.setHours(0,0,0,0);

    for (let day = 1; day <= daysInMonth; day++) {
      const dateStr = `${year}-${String(month+1).padStart(2,"0")}-${String(day).padStart(2,"0")}`;
      const dateObj = new Date(year, month, day);
      const isHoliday = holidays[dateStr] !== undefined;
      const hasManualEvent = manualEvents[dateStr] !== undefined;
      const showHoliday = filterHoliday.checked && isHoliday;
      const showManual = filterManual.checked && hasManualEvent;
      
      const dayClasses = ['day', 'text-center', 'rounded-lg', 'cursor-pointer', 'transition-colors', 'duration-200', 'relative', 'p-1', 'pb-3', 'outline-none', 'focus-visible:ring-2', 'focus-visible:ring-offset-2', 'focus-visible:ring-offset-[--bg-color]', 'focus-visible:ring-[--accent-color]'];
      if (dateObj.getDay() === 0) dayClasses.push("is-sunday");
      if (showHoliday) dayClasses.push("is-holiday");
      if (+dateObj === +today) dayClasses.push("today");
      if (selectedDateStr === dateStr) dayClasses.push("selected");
      
      const pasaran = getPasaranJawa(dateObj);
      let dotsHTML = '<div class="dots-container absolute bottom-[3px] left-0 right-0 flex justify-center gap-1 pointer-events-none">';
      if (showHoliday) dotsHTML += '<span class="dot holiday w-[5px] h-[5px] rounded-full bg-[--holiday-color]"></span>';
      if (showManual) dotsHTML += '<span class="dot manual w-[5px] h-[5px] rounded-full bg-[--accent-color]"></span>';
      dotsHTML += '</div>';

      calendarGrid.innerHTML += `
        <div class="${dayClasses.join(" ")}" data-date="${dateStr}" tabindex="0" role="button">
          <div class="day-number w-7 h-7 leading-7 rounded-full mx-auto transition-all duration-200">
            ${day}
          </div>
          <div class="pasaran block text-xs leading-tight text-[--text-color-muted] transition-colors duration-200">
            ${pasaran}
          </div>
          ${dotsHTML}
        </div>`;
    }
    // Apply Tailwind classes based on state classes
    document.querySelectorAll('.day.is-sunday .day-number').forEach(el => el.classList.add('text-[--holiday-color]', 'font-bold'));
    document.querySelectorAll('.day.is-holiday .day-number').forEach(el => el.classList.add('font-bold', 'text-[--holiday-color]'));
    document.querySelectorAll('.day.today .day-number').forEach(el => el.classList.add('border-2', 'border-[--accent-color]', 'text-[--accent-color]', 'bg-[rgba(var(--accent-color-rgb),0.1)]'));
    document.querySelectorAll('.day.selected').forEach(el => {
        el.classList.add('bg-[--accent-color]', 'text-white', 'font-bold');
        el.querySelector('.pasaran')?.classList.add('text-white/80');
        el.querySelector('.dot.manual')?.classList.add('bg-white');
        el.querySelector('.day-number')?.classList.add('border-transparent', 'bg-transparent', 'text-white');
    });

    document.querySelectorAll(".day").forEach(dayEl => {
      dayEl.addEventListener("click", () => {
        if (navigator.vibrate) navigator.vibrate(10);
        selectedDateStr = dayEl.getAttribute("data-date");
        renderCalendar();
        updateHolidayDescription();
      });
      dayEl.addEventListener("keydown", (e) => {
          if(e.key === "Enter" || e.key === " ") {
              e.preventDefault();
              dayEl.click();
          }
      });
    });
  }

  function updateHolidayDescription() {
    holidayDesc.style.display = "none";
    holidayDesc.innerHTML = "";
    if (!selectedDateStr) return;

    const diffDays = daysDifference(selectedDateStr);
    let diffText;
    if(diffDays === 0) diffText = "Hari ini";
    else if(diffDays > 0) diffText = `Dalam ${diffDays} hari`;
    else diffText = `${Math.abs(diffDays)} hari yang lalu`;

    let contentHTML = '';
    const isHoliday = filterHoliday.checked && holidays[selectedDateStr];
    const event = filterManual.checked ? manualEvents[selectedDateStr] : null;

    const actionBtnBaseClasses = "group action-btn bg-transparent border-none cursor-pointer p-1 rounded-full flex items-center justify-center transition-colors duration-200";

    if (isHoliday) {
        contentHTML += `<div>
            <div class="flex justify-between items-center gap-2">
                <div class="inline-block text-xs font-bold uppercase px-2 py-0.5 rounded-full text-white bg-[--holiday-color]">Libur Nasional</div>
            </div>
            <div class="text-lg font-semibold mt-1.5 mb-2">${holidays[selectedDateStr]}</div>
        </div>`;
    }
    if (event) {
        const timeHTML = event.time ? `<div class="font-bold text-base mt-1.5 mb-[-2px]">Pukul ${event.time}</div>` : '';
        const descHTML = event.desc ? `<div class="text-white/90 text-sm mt-1 break-words">${event.desc.replace(/\n/g, '<br>')}</div>` : '';
        const reminderBtnHTML = event.time ? `<button class="${actionBtnBaseClasses} reminder-btn hover:bg-[--info-bg-color] ${event.reminder ? 'active' : ''}" data-date="${selectedDateStr}" title="Toggle Pengingat">${event.reminder ? reminderIconSVG : reminderOffIconSVG}</button>` : '';

        contentHTML += `<div class="${isHoliday ? 'mt-4' : 'mt-0'}">
            <div class="flex justify-between items-center gap-2">
                <div class="inline-block text-xs font-bold uppercase px-2 py-0.5 rounded-full text-white bg-[--accent-color]">Acara Anda</div>
                <div class="flex gap-1">
                    ${reminderBtnHTML}
                    <button class="${actionBtnBaseClasses} edit-btn hover:bg-[--warning-bg-color]" data-date="${selectedDateStr}" title="Edit Acara">${editIconSVG}</button>
                    <button class="${actionBtnBaseClasses} delete-btn hover:bg-[--danger-bg-color]" data-date="${selectedDateStr}" title="Hapus Acara">${deleteIconSVG}</button>
                </div>
            </div>
            <div class="text-lg font-semibold mt-1.5 mb-0">${event.title}</div>
            ${timeHTML}
            ${descHTML}
        </div>`;
    }
    
    holidayDesc.classList.remove('animate-desc');
    void holidayDesc.offsetWidth;
    
    if (contentHTML) {
      holidayDesc.innerHTML = `${contentHTML}<div class="text-sm text-[--text-color-muted] mt-3">${formatDateDMY(selectedDateStr)} • ${diffText}</div>`;
      holidayDesc.style.display = "block";
    } else {
      holidayDesc.innerHTML = `<div class="text-sm text-[--text-color-muted]">${formatDateDMY(selectedDateStr)} • ${diffText}</div>`;
      holidayDesc.style.display = "block";
    }
    holidayDesc.classList.add("animate-desc");
  }

  async function simpleRender() {
    const year = currentDate.getFullYear();
    if (holidays._year !== year) await fetchHolidays(year);
    renderCalendar();
    updateHolidayDescription();
  }
  
  async function changeMonth(direction) {
    if (isAnimating) return;
    isAnimating = true;

    const outClass = direction === 'next' ? 'slide-out-left' : 'slide-out-right';
    const inClass = direction === 'next' ? 'slide-in-from-right' : 'slide-in-from-left';

    calendarGrid.classList.add(outClass);

    calendarGrid.addEventListener('animationend', async function handleAnimationEnd() {
      calendarGrid.removeEventListener('animationend', handleAnimationEnd);
      currentDate.setMonth(currentDate.getMonth() + (direction === 'next' ? 1 : -1));
      await simpleRender();
      calendarGrid.classList.remove(outClass);
      calendarGrid.classList.add(inClass);
      calendarGrid.addEventListener('animationend', function handleInAnimationEnd() {
        calendarGrid.removeEventListener('animationend', handleInAnimationEnd);
        calendarGrid.classList.remove(inClass);
        isAnimating = false;
      }, { once: true });
    }, { once: true });
  }

  function renderEventList() {
      eventListContainer.innerHTML = '';
      const sortedDates = Object.keys(manualEvents).sort((a,b) => new Date(a) - new Date(b));

      if (sortedDates.length === 0) {
          eventListContainer.innerHTML = `<div class="empty-list-message text-center p-8 text-[--text-color-muted]">Belum ada acara yang ditambahkan.</div>`;
          return;
      }
      
      const actionBtnBaseClasses = "group action-btn bg-transparent border-none cursor-pointer p-1 rounded-full flex items-center justify-center transition-colors duration-200";

      sortedDates.forEach(date => {
          const event = manualEvents[date];
          const timeInfo = event.time ? ` • Pukul ${event.time}` : '';
          const reminderBtnHTML = event.time ? `<button class="${actionBtnBaseClasses} reminder-btn hover:bg-[--info-bg-color] ${event.reminder ? 'active' : ''}" data-date="${date}" title="Toggle Pengingat">${event.reminder ? reminderIconSVG : reminderOffIconSVG}</button>` : `<div style="width: calc(18px + 0.5rem)"></div>`;

          const item = document.createElement('div');
          item.className = 'event-list-item bg-white/5 p-3 rounded-lg mb-3 flex items-center gap-3';
          item.innerHTML = `
              <div class="event-list-item-info flex-grow">
                  <div class="event-list-item-date text-sm text-[--text-color-muted] mb-1">${formatDateDMY(date)}${timeInfo}</div>
                  <div class="event-list-item-title font-bold text-[--accent-color]">${event.title}</div>
                  ${event.desc ? `<div class="event-list-item-desc text-sm opacity-80">${event.desc.substring(0, 50)}${event.desc.length > 50 ? '...' : ''}</div>` : ''}
              </div>
              <div class="desc-header-actions flex gap-1">
                  ${reminderBtnHTML}
                  <button class="${actionBtnBaseClasses} edit-btn hover:bg-[--warning-bg-color]" data-date="${date}" title="Edit Acara">${editIconSVG}</button>
                  <button class="${actionBtnBaseClasses} delete-btn hover:bg-[--danger-bg-color]" data-date="${date}" title="Hapus Acara">${deleteIconSVG}</button>
              </div>
          `;
          eventListContainer.appendChild(item);
      });
  }
  
  // Local Storage & Persistence
  function saveManualEvents() {
      try { localStorage.setItem('manualEvents', JSON.stringify(manualEvents)); } 
      catch (e) { console.error("Gagal menyimpan acara:", e); showToast("Gagal menyimpan acara ke local storage."); }
  }

  function loadManualEvents() {
      try {
          const savedEvents = localStorage.getItem('manualEvents');
          if (savedEvents) { manualEvents = JSON.parse(savedEvents); }
      } catch (e) { console.error("Gagal memuat acara:", e); manualEvents = {}; }
  }
  
  // Event Listener
  document.getElementById("prevMonth").onclick = () => changeMonth('prev');
  document.getElementById("nextMonth").onclick = () => changeMonth('next');
  document.getElementById("goYearBtn").onclick = () => { 
    const y = parseInt(document.getElementById("yearInput").value); 
    if (y >= 1900 && y <= 2100) { currentDate.setFullYear(y); simpleRender(); } 
  };
  document.getElementById("resetBtn").onclick = () => { 
      currentDate = new Date();
      selectedDateStr = currentDate.toISOString().slice(0,10);
      simpleRender();
  };

  let touchStartX=0;
  calendarContainer.addEventListener("touchstart", e => { if(isAnimating) return; touchStartX = e.changedTouches[0].screenX; }, {passive: true});
  calendarContainer.addEventListener("touchend", e => { 
    if(isAnimating) return;
    const deltaX = e.changedTouches[0].screenX - touchStartX;
    if (deltaX > 50) { changeMonth('prev'); } else if (deltaX < -50) { changeMonth('next'); }
  });
  
  menuToggle.addEventListener("click", () => {
    const isOpen = menuPanel.classList.toggle("open");
    menuToggle.classList.toggle("open", isOpen);
    menuToggle.setAttribute("aria-expanded", isOpen);
    menuPanel.setAttribute("aria-hidden", !isOpen);
  });

  [filterHoliday, filterManual].forEach(el => el.addEventListener("change", () => simpleRender() ));
  
  function getRGB(colorStr) {
      const d = document.createElement("div");
      d.style.color = colorStr;
      document.body.appendChild(d);
      const rgb = getComputedStyle(d).color.match(/\d+/g);
      d.remove();
      return rgb ? rgb.slice(0, 3).join(', ') : '144, 202, 249';
  }

  function applyTheme(themeName) {
    const themeData = themes[themeName];
    // Define all CSS variables for the theme
    const rootStyle = document.documentElement.style;
    rootStyle.setProperty('--bg-color', '#1a1a1a');
    rootStyle.setProperty('--bg-color-light', '#282828');
    rootStyle.setProperty('--text-color', '#f0f0f0');
    rootStyle.setProperty('--text-color-muted', '#9e9e9e');
    rootStyle.setProperty('--border-color', 'rgba(255, 255, 255, 0.1)');
    rootStyle.setProperty('--danger-color', '#ff6b6b');
    rootStyle.setProperty('--danger-bg-color', 'rgba(255, 107, 107, 0.1)');
    rootStyle.setProperty('--warning-color', '#ffc107');
    rootStyle.setProperty('--warning-bg-color', 'rgba(255, 193, 7, 0.1)');
    rootStyle.setProperty('--info-color', '#64b5f6');
    rootStyle.setProperty('--info-bg-color', 'rgba(100, 181, 246, 0.1)');
    
    // Override with theme-specific variables
    Object.keys(themeData.vars).forEach(key => rootStyle.setProperty(key, themeData.vars[key]));
    
    const accentColor = themeData.vars['--accent-color'];
    rootStyle.setProperty('--accent-color-rgb', getRGB(accentColor));
    
    currentThemeText.textContent = themeData.name;
    document.querySelectorAll('.theme-option').forEach(opt => {
        opt.classList.toggle('selected', opt.dataset.theme === themeName);
    });
    localStorage.setItem('calendarTheme', themeName);
    if(document.body.getAttribute('data-initialized')) { simpleRender(); }
  }
  
  const themes = {
    'theme-blue': { name: 'Biru', vars: {'--accent-color':'#90caf9', '--holiday-color':'#ff8a80'} },
    'theme-green': { name: 'Hijau', vars: {'--accent-color':'#81c784', '--holiday-color':'#ff8a65'} },
    'theme-purple': { name: 'Ungu', vars: {'--accent-color':'#ce93d8', '--holiday-color':'#ffd54f'} }
  };
  
  addEventBtn.addEventListener("click", () => {
      eventForm.reset();
      eventForm.removeAttribute('data-edit-date');
      modalTitle.textContent = "Tambah Acara Anda";
      document.getElementById('eventDate').value = selectedDateStr || new Date().toISOString().slice(0,10);
      updateReminderRowState();
      eventModal.classList.add("active");
  });

  [eventModal, themeModal, eventListModal, confirmModal].forEach(modal => {
    modal.querySelector(".close-btn")?.addEventListener("click", () => modal.classList.remove("active"));
  });
  
  themeMenuItem.addEventListener("click", () => themeModal.classList.add("active"));
  
  viewEventsBtn.addEventListener("click", () => {
      renderEventList();
      eventListModal.classList.add("active");
  });
  
  document.querySelectorAll('.theme-option').forEach(option => {
    option.addEventListener('click', () => {
      applyTheme(option.dataset.theme);
      themeModal.classList.remove('active');
    });
  });

  eventTimeInput.addEventListener('input', updateReminderRowState);
  function updateReminderRowState() {
      formReminderRow.classList.toggle('disabled', !eventTimeInput.value);
      if (!eventTimeInput.value) { eventReminder.checked = false; }
  }

  eventReminder.addEventListener('change', async () => { if(eventReminder.checked) await requestNotificationPermission() });

  eventForm.addEventListener("submit", e => {
    e.preventDefault();
    const originalDate = eventForm.dataset.editDate;
    const newDate = eventForm.eventDate.value;
    const title = eventForm.eventTitle.value.trim();
    const desc = eventForm.eventDesc.value.trim();
    const time = eventForm.eventTime.value;
    const reminder = eventReminder.checked;
    
    if (!newDate || !title) { showToast("Tanggal dan Judul wajib diisi."); return; }

    if (originalDate && originalDate !== newDate) { delete manualEvents[originalDate]; }
    
    manualEvents[newDate] = { title, desc, time, reminder };
    saveManualEvents();
    
    eventModal.classList.remove("active");
    showToast(originalDate ? "Acara telah diperbarui." : "Acara baru disimpan.");
    
    selectedDateStr = newDate;
    simpleRender();
    updateHolidayDescription();
  });

  function handleEdit(date) {
    const event = manualEvents[date]; if (!event) return;
    eventForm.reset();
    modalTitle.textContent = "Edit Acara Anda";
    eventForm.dataset.editDate = date;
    eventForm.eventDate.value = date;
    eventForm.eventTitle.value = event.title;
    eventForm.eventTime.value = event.time || '';
    eventForm.eventDesc.value = event.desc || '';
    eventReminder.checked = event.reminder || false;
    updateReminderRowState();
    eventModal.classList.add("active");
  }

  async function handleDelete(date) {
      if (!manualEvents[date]) return;
      const eventTitle = manualEvents[date]?.title;
      const confirmed = await showCustomConfirm(`Apakah Anda yakin ingin menghapus acara <br><b>"${eventTitle}"</b>?`);

      if (confirmed) {
          delete manualEvents[date];
          saveManualEvents();
          showToast("Acara telah dihapus.");
          if (selectedDateStr === date) updateHolidayDescription();
          simpleRender();
          if (eventListModal.classList.contains('active')) renderEventList();
      }
  }

  async function handleReminderToggle(date) {
    const event = manualEvents[date]; if (!event || !event.time) return;
    if (!event.reminder) {
      const permissionGranted = await requestNotificationPermission();
      if (!permissionGranted) { showToast("Izin notifikasi diperlukan."); return; }
    }
    event.reminder = !event.reminder;
    saveManualEvents();
    showToast(`Pengingat ${event.reminder ? 'diaktifkan' : 'dinonaktifkan'}.`);
    updateHolidayDescription();
    if (eventListModal.classList.contains('active')) renderEventList();
  }

  function setupActionListeners() {
    document.body.addEventListener('click', function(e) {
      const button = e.target.closest('.action-btn'); if (!button) return;
      e.stopPropagation();
      const date = button.dataset.date;
      if (button.classList.contains('edit-btn')) handleEdit(date);
      else if (button.classList.contains('delete-btn')) handleDelete(date);
      else if (button.classList.contains('reminder-btn')) handleReminderToggle(date);
    });
  }

  let confirmResolve = null;
  function showCustomConfirm(message) {
      return new Promise(resolve => {
          confirmResolve = resolve;
          document.getElementById('confirmMessage').innerHTML = message;
          confirmModal.classList.add('active');
      });
  }

  document.getElementById('confirmBtnYes').addEventListener('click', () => { if(confirmResolve) confirmResolve(true); confirmModal.classList.remove('active'); });
  document.getElementById('confirmBtnNo').addEventListener('click', () => { if(confirmResolve) confirmResolve(false); confirmModal.classList.remove('active'); });

  function showToast(msg) {
    toast.textContent = msg;
    toast.classList.add("show");
    setTimeout(() => toast.classList.remove("show"), 2500);
  }

  async function requestNotificationPermission() {
    if (!("Notification" in window)) { showToast("Browser ini tidak mendukung notifikasi."); return false; }
    if (Notification.permission === 'granted') return true;
    if (Notification.permission !== 'denied') {
        const permission = await Notification.requestPermission();
        return permission === 'granted';
    }
    return false;
  }

  function showNotification(title, options) {
      if (Notification.permission === 'granted') {
          navigator.serviceWorker.ready.then(reg => reg.showNotification(title, options));
      }
  }

  function checkEventNotifications() {
      const now = new Date();
      const todayStr = now.toISOString().slice(0, 10);
      const currentTimeStr = now.toTimeString().slice(0, 5);

      const event = manualEvents[todayStr];
      if (event && event.reminder && event.time === currentTimeStr) {
          if (event.lastNotified !== currentTimeStr) { 
              console.log(`Menampilkan notifikasi untuk: ${event.title}`);
              showNotification("Pengingat Acara", { body: `${event.title} dimulai sekarang.`, icon: './favicon.ico', vibrate: [200, 100, 200] });
              event.lastNotified = currentTimeStr;
          }
      }
  }
  
  function setCopyright() {
    const currentYear = new Date().getFullYear();
    document.getElementById('copyright-footer').innerHTML = `&copy; ${currentYear} Kalender Libur Nasional. All Rights Reserved.`;
  }

  (async function init() {
    loadManualEvents();
    setupActionListeners();
    setCopyright();
    const savedTheme = localStorage.getItem('calendarTheme') || 'theme-blue';
    applyTheme(savedTheme);
    
    selectedDateStr = new Date().toISOString().slice(0,10);
    await simpleRender();
    document.body.setAttribute('data-initialized', 'true');
    
    setInterval(checkEventNotifications, 60000);
    checkEventNotifications();
  })();
</script>

</body>
</html>