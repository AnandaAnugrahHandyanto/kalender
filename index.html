<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Kalender Libur Nasional</title>
<style>
  body {
    font-family: Arial, sans-serif;
    margin: 0;
    background-color: var(--bg-color);
    color: var(--text-color);
    transition: background 0.3s, color 0.3s;
  }
  :root {
    --bg-color: #ffffff;
    --text-color: #000000;
    --accent-color: #1a73e8;
    --holiday-color: #e53935;
    --neon-green: #39ff14;
  }
  body.dark {
    --bg-color: #121212;
    --text-color: #ffffff;
    --accent-color: #90caf9;
    --holiday-color: #ff8a80;
  }
  header {
    background: var(--accent-color);
    color: white;
    padding: 8px;
    user-select: none;
  }
  .top-row {
    display: flex;
    align-items: center;
    justify-content: space-between;
  }
  .month-title {
    flex: 1;
    text-align: center;
    font-size: 1.3rem;
    font-weight: bold;
  }
  .month-btn {
    background: white;
    color: var(--accent-color);
    border: none;
    border-radius: 5px;
    font-size: 1.2rem;
    font-weight: bold;
    width: 32px;
    height: 32px;
    cursor: pointer;
  }
  .month-btn:hover {
    background: var(--accent-color);
    color: white;
  }
  .bottom-row {
    display: flex;
    justify-content: center;
    align-items: center;
    gap: 6px;
    margin-top: 6px;
    flex-wrap: wrap;
  }
  input[type=number] {
    width: 70px;
    padding: 4px;
    border-radius: 5px;
    border: none;
    text-align: center;
  }
  .control-btn {
    padding: 5px 10px;
    border: none;
    border-radius: 5px;
    background: white;
    color: var(--accent-color);
    cursor: pointer;
    font-size: 0.9rem;
    font-weight: bold;
  }
  .control-btn:hover {
    background: var(--accent-color);
    color: white;
  }
  #toggleMode {
    background: transparent;
    border: none;
    font-size: 1.3rem;
    cursor: pointer;
    color: white;
  }
  .calendar {
    max-width: 600px;
    margin: 12px auto;
    padding: 0 10px;
    touch-action: pan-y;
  }
  .calendar-grid {
    display: grid;
    grid-template-columns: repeat(7, 1fr);
    gap: 5px;
  }
  .calendar-grid > div {
    text-align: center;
  }
  .calendar-grid > div.header-day {
    font-weight: bold;
    padding: 5px 0;
    border-bottom: 2px solid var(--accent-color);
  }
  .calendar-grid > div.day {
    padding: 6px 4px;
    border-radius: 6px;
    cursor: pointer;
    transition: background-color 0.2s ease, color 0.2s ease;
    position: relative;
  }
  .calendar-grid > div.day.selected {
    padding: 3px;
    border-radius: 6px; /* tetap kotak kecil */
  }
  .calendar-grid > div.day.holiday {
    color: var(--holiday-color);
    font-weight: bold;
  }
  .calendar-grid > div.day.today {
    border: 2px solid var(--accent-color);
    font-weight: bold;
  }
  .pasaran {
    display: block;
    font-size: 0.6rem;
    line-height: 1.2rem;
    min-height: 1.2rem;
    color: #999;
    transition: color 0.2s ease, font-size 0.2s ease, font-weight 0.2s ease;
  }
  .pasaran.active {
    font-size: 0.75rem;
    font-weight: bold;
  }
  /* Titik penanda hijau neon */
  .selected-dot {
    width: 6px;
    height: 6px;
    border-radius: 50%;
    position: absolute;
    bottom: -4px;
    left: 50%;
    transform: translateX(-50%);
    background: var(--neon-green);
    animation: pulse 1.5s infinite ease-in-out;
  }
  @keyframes pulse {
    0%, 100% { opacity: 1; transform: translateX(-50%) scale(1); }
    50% { opacity: 0.4; transform: translateX(-50%) scale(1.4); }
  }
  /* Glow default biru */
  #holidayDescription {
    display: none;
    max-width: 600px;
    margin: 12px auto 20px;
    padding: 16px;
    font-size: 1rem;
    border-radius: 10px;
    background: rgba(26, 115, 232, 0.08);
    color: var(--text-color);
    border: 2px solid var(--accent-color);
    box-shadow: 0 0 8px var(--accent-color);
  }
  body.dark #holidayDescription {
    background: rgba(144, 202, 249, 0.08);
    color: #bbdefb;
    border-color: var(--accent-color);
    box-shadow: 0 0 8px var(--accent-color);
  }
  /* Glow merah lembut untuk libur resmi */
  #holidayDescription.holiday-glow {
    background: rgba(229, 57, 53, 0.08);
    border-color: var(--holiday-color);
    box-shadow: 0 0 8px var(--holiday-color);
  }
  body.dark #holidayDescription.holiday-glow {
    background: rgba(255, 138, 128, 0.08);
    border-color: var(--holiday-color);
    box-shadow: 0 0 8px var(--holiday-color);
  }
  #holidayDescription .desc-holiday {
    font-size: 1.2rem;
    font-weight: bold;
    color: var(--holiday-color);
    margin-bottom: 6px;
  }
  #holidayDescription .desc-diff {
    font-size: 0.95rem;
    font-style: italic;
    color: var(--accent-color);
  }
  /* Animasi deskripsi */
  .animate-desc {
    animation: slideFade 0.3s ease;
  }
  @keyframes slideFade {
    from { opacity: 0; transform: translateY(10px); }
    to { opacity: 1; transform: translateY(0); }
  }
  /* Loading spinner */
  #loadingSpinner {
    display:none;
    position:fixed;
    top:50%;
    left:50%;
    transform:translate(-50%,-50%);
    border:5px solid rgba(26,115,232,0.2);
    border-top-color:var(--accent-color);
    border-radius:50%;
    width:48px;
    height:48px;
    animation:spin 1s linear infinite;
    z-index: 1000;
  }
  @keyframes spin {
    to { transform: rotate(360deg); }
  }
</style>
</head>
<body>
<header>
  <div class="top-row">
    <button id="prevMonth" class="month-btn">âŸ¨</button>
    <div class="month-title" id="monthYear">Loading...</div>
    <button id="nextMonth" class="month-btn">âŸ©</button>
  </div>
  <div class="bottom-row">
    <input type="number" id="yearInput" min="1900" max="2100" />
    <button id="goYearBtn" class="control-btn">Lihat</button>
    <button id="resetBtn" class="control-btn">Reset</button>
    <button id="toggleMode">ðŸŒ™</button>
  </div>
</header>

<div class="calendar">
  <div class="calendar-grid" id="calendarDays"></div>
</div>

<div id="holidayDescription"></div>
<div id="loadingSpinner"></div>

<script>
  const apiKey = "AIzaSyCHdJfqVSd-1rQ1wbbp7uaJwk9Ty2iWRAE";
  const calendarId = "id.indonesian#holiday@group.v.calendar.google.com";
  const dayNames = ["MIN","SEN","SEL","RAB","KAM","JUM","SAB"];
  const pasaranJawa = ["Legi","Pahing","Pon","Wage","Kliwon"];
  let currentDate = new Date();
  let holidays = {};
  let selectedDateStr = null;
  const holidayDesc = document.getElementById("holidayDescription");
  const calendarGrid = document.getElementById("calendarDays");
  const loadingSpinner = document.getElementById("loadingSpinner");

  function getPasaranJawa(date) {
    const refDate = new Date(2023, 0, 1);
    const diffDays = Math.floor((date - refDate) / (1000 * 60 * 60 * 24));
    return pasaranJawa[(diffDays % 5 + 5) % 5];
  }

  async function fetchHolidays(year) {
    loadingSpinner.style.display = "block";
    const timeMin = `${year}-01-01T00:00:00Z`;
    const timeMax = `${year}-12-31T23:59:59Z`;
    const url = `https://www.googleapis.com/calendar/v3/calendars/${encodeURIComponent(calendarId)}/events?key=${apiKey}&timeMin=${timeMin}&timeMax=${timeMax}&singleEvents=true&orderBy=startTime`;
    try {
      const res = await fetch(url);
      const data = await res.json();
      holidays = {};
      if (data.items) {
        data.items.forEach(event => {
          holidays[event.start.date] = event.summary;
        });
      }
    } catch (e) {
      console.error(e);
    } finally {
      loadingSpinner.style.display = "none";
    }
  }

  function renderCalendar() {
    calendarGrid.innerHTML = "";
    const year = currentDate.getFullYear();
    const month = currentDate.getMonth();
    document.getElementById("monthYear").textContent = currentDate.toLocaleString("id-ID", { month: "long", year: "numeric" });
    document.getElementById("yearInput").value = year;

    dayNames.forEach(d => {
      calendarGrid.innerHTML += `<div class="header-day">${d}</div>`;
    });

    const firstDay = new Date(year, month, 1).getDay();
    const daysInMonth = new Date(year, month + 1, 0).getDate();
    for (let i = 0; i < firstDay; i++) calendarGrid.innerHTML += `<div></div>`;

    const today = new Date();
    today.setHours(0,0,0,0);

    for (let day = 1; day <= daysInMonth; day++) {
      const dateStr = `${year}-${String(month+1).padStart(2,"0")}-${String(day).padStart(2,"0")}`;
      const dateObj = new Date(year, month, day);
      const classes = ["day"];
      if (dateObj.getDay() === 0 || holidays[dateStr]) classes.push("holiday");
      if (+dateObj === +today) classes.push("today");
      if (selectedDateStr && selectedDateStr === dateStr) classes.push("selected");

      const pasaran = getPasaranJawa(dateObj);
      let dotHTML = "";
      if (selectedDateStr && selectedDateStr === dateStr) {
        dotHTML = `<div class="selected-dot"></div>`;
      }

      calendarGrid.innerHTML += `<div class="${classes.join(" ")}" data-date="${dateStr}" data-desc="${holidays[dateStr]||''}">
        <div>${day}</div><div class="pasaran">${pasaran}</div>${dotHTML}</div>`;
    }

    document.querySelectorAll(".day").forEach(dayEl => {
      const dateStr = dayEl.getAttribute("data-date");
      dayEl.addEventListener("click", () => {
        // Getar saat klik tanggal
        if (navigator.vibrate) {
          navigator.vibrate(10);
        }

        selectedDateStr = dateStr;
        renderCalendar();
        applySelectionStyle(document.querySelector(`.day[data-date="${dateStr}"]`), holidays[dateStr], dateStr);
      });
    });
  }

  function applySelectionStyle(dayEl, holidayName, dateStr) {
    let desc = holidayName;
    const isSunday = new Date(dateStr).getDay() === 0;
    const today = new Date();
    today.setHours(0,0,0,0);
    const clickedDate = new Date(dateStr);
    clickedDate.setHours(0,0,0,0);
    const diffDays = Math.round((clickedDate - today)/(1000*60*60*24));
    let diffText = diffDays>0?`${diffDays} hari lagi`:diffDays===0?"Hari ini":`${Math.abs(diffDays)} hari lalu`;

    if (!desc && isSunday) {
      desc = "Hari libur";
    }

    // Set warna sesuai jenis hari
    if (desc || isSunday) {
      dayEl.style.backgroundColor = "var(--holiday-color)";
      dayEl.style.color = "white";
      holidayDesc.classList.add("holiday-glow");
    } else {
      dayEl.style.backgroundColor = "var(--accent-color)";
      dayEl.style.color = "white";
      holidayDesc.classList.remove("holiday-glow");
    }

    const pasaranEl = dayEl.querySelector(".pasaran");
    if (pasaranEl) {
      pasaranEl.classList.add("active");
      pasaranEl.style.color = "white";
    }

    holidayDesc.classList.remove("animate-desc");
    void holidayDesc.offsetWidth;

    holidayDesc.innerHTML = `
      <p class="desc-holiday">${desc || 'Tidak ada hari libur'}</p>
      <p class="desc-diff">${diffText}</p>
    `;
    holidayDesc.style.display = "block";
    holidayDesc.classList.add("animate-desc");
  }

  async function checkAndRender() {
    const year = currentDate.getFullYear();
    if (holidays._year !== year) {
      holidays._year = year;
      await fetchHolidays(year);
    }
    renderCalendar();
  }

  document.getElementById("prevMonth").onclick = () => { currentDate.setMonth(currentDate.getMonth() - 1); checkAndRender(); };
  document.getElementById("nextMonth").onclick = () => { currentDate.setMonth(currentDate.getMonth() + 1); checkAndRender(); };
  document.getElementById("goYearBtn").onclick = () => { 
    const y = parseInt(document.getElementById("yearInput").value); 
    if (y>=1900 && y<=2100) { 
      currentDate.setFullYear(y); 
      currentDate.setMonth(0); 
      checkAndRender(); 
    } 
  };
  document.getElementById("resetBtn").onclick = () => { currentDate = new Date(); checkAndRender(); };
  document.getElementById("toggleMode").onclick = () => { 
    document.body.classList.toggle("dark"); 
    document.getElementById("toggleMode").textContent = document.body.classList.contains("dark") ? "â˜€ï¸" : "ðŸŒ™"; 
  };

  let touchStartX=0,touchEndX=0;
  calendarGrid.addEventListener("touchstart", e => touchStartX = e.changedTouches[0].screenX);
  calendarGrid.addEventListener("touchend", e => { 
    touchEndX = e.changedTouches[0].screenX; 
    if (touchEndX - touchStartX > 40) document.getElementById("prevMonth").click(); 
    if (touchEndX - touchStartX < -40) document.getElementById("nextMonth").click(); 
  });

  (function init() { checkAndRender(); })();
</script>
</body>
</html>
