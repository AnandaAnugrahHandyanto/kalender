<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Kalender Libur Nasional</title>
<style>
  :root {
    --bg-color: #121212;
    --text-color: #ffffff;
    --accent-color: #90caf9;
    --holiday-color: #ff8a80;
    --neon-green: #39ff14;
  }
  body {
    margin: 0;
    font-family: Arial, sans-serif;
    background-color: var(--bg-color);
    color: var(--text-color);
    transition: background-color 0.3s, color 0.3s;
    overflow-x: hidden;
  }
  header {
    background: var(--accent-color);
    color: white;
    padding: 8px;
    user-select: none;
  }
  .top-row {
    display: flex;
    align-items: center;
    justify-content: space-between;
  }
  .month-title {
    flex: 1;
    text-align: center;
    font-size: 1.3rem;
    font-weight: bold;
  }
  .month-btn {
    background: white;
    color: var(--accent-color);
    border: none;
    border-radius: 5px;
    font-size: 1.2rem;
    font-weight: bold;
    width: 32px;
    height: 32px;
    cursor: pointer;
  }
  .month-btn:hover {
    background: var(--accent-color);
    color: white;
  }
  .bottom-row {
    margin-top: 6px;
    display: flex;
    justify-content: center;
    align-items: center;
    gap: 6px;
  }
  input[type=number] {
    width: 70px;
    padding: 4px;
    border-radius: 5px;
    border: none;
    text-align: center;
  }
  .control-btn {
    padding: 5px 10px;
    border: none;
    border-radius: 5px;
    background: white;
    color: var(--accent-color);
    cursor: pointer;
    font-size: 0.9rem;
    font-weight: bold;
  }
  .control-btn:hover {
    background: var(--accent-color);
    color: white;
  }
  .calendar {
    max-width: 600px;
    margin: 12px auto;
    padding: 0 10px;
    touch-action: pan-y;
  }
  .calendar-grid {
    display: grid;
    grid-template-columns: repeat(7, 1fr);
    gap: 5px;
  }
  .calendar-grid > div {
    text-align: center;
  }
  .calendar-grid > div.header-day {
    font-weight: bold;
    padding: 5px 0;
    border-bottom: 2px solid var(--accent-color);
  }
  .calendar-grid > div.day {
    padding: 6px 4px;
    border-radius: 6px;
    cursor: pointer;
    transition: background-color 0.2s ease, color 0.2s ease;
    position: relative;
    outline-offset: 2px;
  }
  .calendar-grid > div.day.selected {
    background-color: var(--accent-color);
    color: white;
  }
  .calendar-grid > div.day.holiday {
    color: var(--holiday-color);
    font-weight: bold;
  }
  .calendar-grid > div.day.today {
    border: 2px solid var(--accent-color);
    font-weight: bold;
  }
  .pasaran {
    display: block;
    font-size: 0.6rem;
    line-height: 1.2rem;
    min-height: 1.2rem;
    color: #999;
    transition: color 0.2s ease, font-size 0.2s ease, font-weight 0.2s ease;
  }
  .pasaran.active {
    font-size: 0.75rem;
    font-weight: bold;
  }
  .selected-dot {
    width: 6px;
    height: 6px;
    border-radius: 50%;
    position: absolute;
    bottom: -4px;
    left: 50%;
    transform: translateX(-50%);
    background: var(--neon-green);
    animation: pulse 1.5s infinite ease-in-out;
  }
  @keyframes pulse {
    0%, 100% { opacity: 1; transform: translateX(-50%) scale(1); }
    50% { opacity: 0.4; transform: translateX(-50%) scale(1.4); }
  }
  #holidayDescription {
    max-width: 600px;
    margin: 12px auto 20px;
    padding: 16px;
    font-size: 1rem;
    border-radius: 10px;
    background: rgba(144, 202, 249, 0.08);
    color: var(--text-color);
    border: 2px solid var(--accent-color);
    box-shadow: 0 0 8px var(--accent-color);
    transition: opacity 0.3s ease;
  }
  #holidayDescription.holiday-glow {
    background: rgba(255, 138, 128, 0.08);
    border-color: var(--holiday-color);
    box-shadow: 0 0 8px var(--holiday-color);
  }
  #holidayDescription .desc-holiday {
    font-size: 1.2rem;
    font-weight: bold;
    color: var(--holiday-color);
    margin-bottom: 6px;
  }
  #holidayDescription .desc-diff {
    font-size: 0.95rem;
    font-style: italic;
    color: var(--accent-color);
  }
  .animate-desc {
    animation: slideFade 0.3s ease;
  }
  @keyframes slideFade {
    from { opacity: 0; transform: translateY(10px); }
    to { opacity: 1; transform: translateY(0); }
  }

  #menuToggle {
    position: fixed;
    bottom: 20px;
    right: 20px;
    background: var(--accent-color);
    border: none;
    border-radius: 50%;
    width: 48px;
    height: 48px;
    font-size: 28px;
    color: white;
    cursor: pointer;
    box-shadow: 0 2px 8px rgba(0,0,0,0.3);
    z-index: 1001;
    transition: background-color 0.3s;
  }
  #menuToggle.open {
    background-color: #555;
  }

  #menuPanel {
    position: fixed;
    bottom: 80px;
    right: 20px;
    background: #222;
    border-radius: 10px;
    padding: 12px 20px;
    box-shadow: 0 2px 12px rgba(0,0,0,0.7);
    width: 220px;
    max-width: 90vw;
    color: white;
    opacity: 0;
    pointer-events: none;
    transform: translateY(20px);
    transition: opacity 0.3s ease, transform 0.3s ease;
    z-index: 1000;
  }
  #menuPanel.open {
    opacity: 1;
    pointer-events: auto;
    transform: translateY(0);
  }
  #menuPanel label,
  #menuPanel select,
  #menuPanel button {
    display: block;
    width: 100%;
    margin-bottom: 12px;
    font-size: 1rem;
  }
  #menuPanel input[type=checkbox] {
    margin-right: 6px;
    transform: scale(1.2);
    vertical-align: middle;
  }
  #menuPanel select {
    padding: 6px;
    border-radius: 5px;
    border: none;
    background: #333;
    color: white;
    cursor: pointer;
  }
  #menuPanel button {
    padding: 8px 0;
    background: var(--accent-color);
    color: white;
    border: none;
    border-radius: 6px;
    font-weight: bold;
    cursor: pointer;
  }
  #menuPanel button:hover {
    background: #5aa3f7;
  }

  /* Modal styles */
  #eventModal {
    display: none;
    position: fixed;
    inset: 0;
    background: rgba(0,0,0,0.7);
    z-index: 1100;
    justify-content: center;
    align-items: center;
  }
  #eventModal.active {
    display: flex;
  }
  #eventModal .modal-content {
    background: #222;
    color: white;
    padding: 20px;
    border-radius: 10px;
    width: 90%;
    max-width: 400px;
    box-sizing: border-box;
    position: relative;
  }
  #eventModal .close-btn {
    position: absolute;
    right: 16px;
    top: 12px;
    font-size: 28px;
    cursor: pointer;
    color: #ccc;
    user-select: none;
  }
  #eventModal label {
    display: block;
    margin-top: 12px;
  }
  #eventModal input[type=date],
  #eventModal input[type=text],
  #eventModal textarea {
    width: 100%;
    padding: 6px;
    margin-top: 6px;
    border-radius: 6px;
    border: none;
    background: #444;
    color: white;
    box-sizing: border-box;
    font-size: 1rem;
  }
  #eventModal textarea {
    resize: vertical;
    min-height: 60px;
  }
  #eventModal button[type=submit] {
    margin-top: 16px;
    background: var(--accent-color);
    border: none;
    color: white;
    padding: 10px;
    font-weight: bold;
    border-radius: 6px;
    cursor: pointer;
    width: 100%;
  }
  #eventModal button[type=submit]:hover {
    background: #5aa3f7;
  }

  /* Toast style */
  #toast {
    position: fixed;
    bottom: 80px;
    left: 50%;
    transform: translateX(-50%);
    background: var(--accent-color);
    color: white;
    padding: 12px 20px;
    border-radius: 20px;
    opacity: 0;
    pointer-events: none;
    transition: opacity 0.3s ease;
    font-weight: bold;
    z-index: 1200;
  }
  #toast.show {
    opacity: 1;
    pointer-events: auto;
  }

  #menuToggle {
    position: fixed;
    bottom: 20px;
    right: 20px;
    background: var(--accent-color);
    border: none;
    border-radius: 50%;
    width: 54px;
    height: 54px;
    cursor: pointer;
    box-shadow: 0 6px 20px rgba(0,0,0,0.35);
    z-index: 1001;
    display: flex;
    align-items: center;
    justify-content: center;
    transition: background 0.28s cubic-bezier(.2,.9,.3,1), transform 0.18s ease;
    -webkit-tap-highlight-color: transparent;
  }
  #menuToggle:hover { transform: scale(1.06); }

  /* three-bar */
  #menuToggle .bar {
    width: 26px;
    height: 3px;
    background: white;
    border-radius: 2px;
    position: relative;
    transition: transform 0.28s ease, background 0.28s ease;
  }
  #menuToggle .bar::before,
  #menuToggle .bar::after {
    content: "";
    position: absolute;
    left: 0;
    width: 26px;
    height: 3px;
    background: white;
    border-radius: 2px;
    transition: transform 0.28s ease, top 0.28s ease, opacity 0.28s ease;
  }
  #menuToggle .bar::before { top: -8px; }
  #menuToggle .bar::after { top: 8px; }

  /* open state -> X */
  #menuToggle.open .bar { background: transparent; }
  #menuToggle.open .bar::before {
    transform: rotate(45deg);
    top: 0;
  }
  #menuToggle.open .bar::after {
    transform: rotate(-45deg);
    top: 0;
  }

  /* Panel menu with slide-up + blur + subtle scale */
  #menuPanel {
    position: fixed;
    bottom: 84px;
    right: 20px;
    background: rgba(18,18,18,0.72);
    backdrop-filter: blur(10px) saturate(120%);
    border-radius: 14px;
    padding: 14px 18px;
    box-shadow: 0 10px 30px rgba(0,0,0,0.5);
    width: 260px;
    max-width: 92vw;
    color: white;
    opacity: 0;
    pointer-events: none;
    transform: translateY(22px) scale(0.985);
    transition: opacity 260ms cubic-bezier(.2,.9,.3,1), transform 260ms cubic-bezier(.2,.9,.3,1);
    z-index: 1000;
  }
  #menuPanel.open {
    opacity: 1;
    pointer-events: auto;
    transform: translateY(0) scale(1);
  }
  #menuPanel label,
  #menuPanel select,
  #menuPanel button {
    display: block;
    width: 100%;
    margin-bottom: 12px;
    font-size: 1rem;
  }
  #menuPanel input[type=checkbox] { margin-right: 8px; transform: scale(1.1); vertical-align: middle; }
  #menuPanel select {
    padding: 8px;
    border-radius: 8px;
    border: none;
    background: rgba(255,255,255,0.03);
    color: white;
    cursor: pointer;
    outline: none;
    -webkit-appearance: none;
  }
  #menuPanel button {
    padding: 10px 0;
    background: linear-gradient(180deg, var(--accent-color), rgba(90,163,247,0.9));
    color: white;
    border: none;
    border-radius: 8px;
    font-weight: 700;
    cursor: pointer;
    box-shadow: 0 6px 18px rgba(33,150,243,0.12), inset 0 -2px 6px rgba(0,0,0,0.12);
  }
  #menuPanel button:hover { transform: translateY(-1px); }
  /* small responsive tweak */
  @media (max-width:420px) {
    #menuToggle { right: 14px; bottom: 18px; width:50px; height:50px; }
    #menuPanel { right: 12px; width: 88vw; bottom: 78px; }
  }
</style>
</head>
<body class="theme-blue">

<header>
  <div class="top-row">
    <button id="prevMonth" class="month-btn" aria-label="Bulan sebelumnya">⟨</button>
    <div class="month-title" id="monthYear" aria-live="polite" aria-atomic="true">Loading...</div>
    <button id="nextMonth" class="month-btn" aria-label="Bulan berikutnya">⟩</button>
  </div>
  <div class="bottom-row">
    <input type="number" id="yearInput" min="1900" max="2100" aria-label="Masukkan tahun" />
    <button id="goYearBtn" class="control-btn">Lihat</button>
    <button id="resetBtn" class="control-btn">Reset</button>
  </div>
</header>

<div class="calendar" role="grid" aria-label="Kalender libur nasional">
  <div class="calendar-grid" id="calendarDays"></div>
</div>

<div id="holidayDescription" role="region" aria-live="polite" aria-atomic="true" style="display:none;"></div>

<!-- Tombol hamburger: diganti jadi tiga-bar animated icon (tetap id dan atribut sama agar JS tetap berfungsi) -->
<button id="menuToggle" aria-label="Toggle Menu" aria-expanded="false">
  <div class="bar" aria-hidden="true"></div>
</button>
<div id="menuPanel" aria-hidden="true">
  <label><input type="checkbox" id="filterHoliday" checked /> Tampilkan Libur Nasional</label>
  <label><input type="checkbox" id="filterManual" checked /> Tampilkan Event Manual</label>
  <label for="themeSelect">Tema Warna:</label>
  <select id="themeSelect" aria-label="Pilih Tema Warna">
    <option value="theme-blue" selected>Biru</option>
    <option value="theme-green">Hijau</option>
    <option value="theme-purple">Ungu</option>
  </select>
  <button id="addEventBtn">+ Tambah Event Manual</button>
</div>

<div id="eventModal" role="dialog" aria-modal="true" aria-labelledby="modalTitle">
  <div class="modal-content">
    <span class="close-btn" role="button" aria-label="Tutup">&times;</span>
    <h2 id="modalTitle">Tambah Event Manual</h2>
    <form id="eventForm">
      <label for="eventDate">Tanggal:</label>
      <input type="date" id="eventDate" name="eventDate" required />
      <label for="eventTitle">Judul:</label>
      <input type="text" id="eventTitle" name="eventTitle" required />
      <label for="eventDesc">Deskripsi (opsional):</label>
      <textarea id="eventDesc" name="eventDesc"></textarea>
      <button type="submit">Simpan Event</button>
    </form>
  </div>
</div>

<div id="toast"></div>

<script>
  const apiKey = "AIzaSyCHdJfqVSd-1rQ1wbbp7uaJwk9Ty2iWRAE";
  const calendarId = "id.indonesian#holiday@group.v.calendar.google.com";
  const dayNames = ["MIN","SEN","SEL","RAB","KAM","JUM","SAB"];
  const pasaranJawa = ["Legi","Pahing","Pon","Wage","Kliwon"];
  let currentDate = new Date();
  let holidays = {};
  let manualEvents = {};
  let selectedDateStr = null;

  const holidayDesc = document.getElementById("holidayDescription");
  const calendarGrid = document.getElementById("calendarDays");
  const filterHoliday = document.getElementById("filterHoliday");
  const filterManual = document.getElementById("filterManual");
  const themeSelect = document.getElementById("themeSelect");
  const menuToggle = document.getElementById("menuToggle");
  const menuPanel = document.getElementById("menuPanel");
  const addEventBtn = document.getElementById("addEventBtn");
  const eventModal = document.getElementById("eventModal");
  const eventForm = document.getElementById("eventForm");
  const toast = document.getElementById("toast");

  function getPasaranJawa(date) {
    const refDate = new Date(2023, 0, 1);
    const diffDays = Math.floor((date - refDate) / (1000 * 60 * 60 * 24));
    return pasaranJawa[(diffDays % 5 + 5) % 5];
  }

  async function fetchHolidays(year) {
    const timeMin = `${year}-01-01T00:00:00Z`;
    const timeMax = `${year}-12-31T23:59:59Z`;
    const url = `https://www.googleapis.com/calendar/v3/calendars/${encodeURIComponent(calendarId)}/events?key=${apiKey}&timeMin=${timeMin}&timeMax=${timeMax}&singleEvents=true&orderBy=startTime`;
    try {
      const res = await fetch(url);
      const data = await res.json();
      holidays = {};
      if (data.items) {
        data.items.forEach(event => {
          holidays[event.start.date] = event.summary;
        });
      }
      holidays._year = year;
    } catch (e) {
      console.error(e);
    }
  }

  function formatDateDMY(dateStr) {
    const parts = dateStr.split("-");
    return parts[2] + "/" + parts[1] + "/" + parts[0];
  }

  function daysDifference(dateStr) {
    const today = new Date();
    today.setHours(0,0,0,0);
    const targetDate = new Date(dateStr);
    targetDate.setHours(0,0,0,0);
    const diff = Math.floor((targetDate - today) / (1000 * 60 * 60 * 24));
    return diff;
  }

  function renderCalendar() {
    calendarGrid.innerHTML = "";
    const year = currentDate.getFullYear();
    const month = currentDate.getMonth();

    document.getElementById("monthYear").textContent = currentDate.toLocaleString("id-ID", { month: "long", year: "numeric" });
    document.getElementById("yearInput").value = year;

    dayNames.forEach(d => {
      calendarGrid.innerHTML += `<div class="header-day">${d}</div>`;
    });

    const firstDay = new Date(year, month, 1).getDay();
    const daysInMonth = new Date(year, month + 1, 0).getDate();

    for (let i = 0; i < firstDay; i++) {
      calendarGrid.innerHTML += `<div></div>`;
    }

    const today = new Date();
    today.setHours(0,0,0,0);

    for (let day = 1; day <= daysInMonth; day++) {
      const dateStr = `${year}-${String(month+1).padStart(2,"0")}-${String(day).padStart(2,"0")}`;
      const dateObj = new Date(year, month, day);

      const classes = ["day"];
      const isHoliday = holidays[dateStr] !== undefined;
      const hasManualEvent = manualEvents[dateStr] !== undefined;
      const showHoliday = filterHoliday.checked && isHoliday;
      const showManual = filterManual.checked && hasManualEvent;

      if (dateObj.getDay() === 0 && !showHoliday && !showManual) classes.push("holiday");
      if (showHoliday) classes.push("holiday");
      if (showManual) classes.push("day-manual");
      if (+dateObj === +today) classes.push("today");
      if (selectedDateStr === dateStr) classes.push("selected");

      const pasaran = getPasaranJawa(dateObj);
      let dotHTML = "";
      if (selectedDateStr === dateStr) {
        dotHTML = `<div class="selected-dot"></div>`;
      }

      let title = "";
      if (showHoliday) title = holidays[dateStr];
      else if (showManual) title = manualEvents[dateStr].title;

      calendarGrid.innerHTML += `
        <div class="${classes.join(" ")}" data-date="${dateStr}" tabindex="0" title="${title}">
          <div>${day}</div><div class="pasaran">${pasaran}</div>${dotHTML}
        </div>`;
    }

    document.querySelectorAll(".day").forEach(dayEl => {
      dayEl.addEventListener("click", () => {
        if (navigator.vibrate) navigator.vibrate(10);
        selectedDateStr = dayEl.getAttribute("data-date");
        renderCalendar();
        updateHolidayDescription();
      });
    });
  }

  function updateHolidayDescription() {
    if (!selectedDateStr) {
      holidayDesc.style.display = "none";
      holidayDesc.textContent = "";
      return;
    }

    const diffDays = daysDifference(selectedDateStr);
    const diffText = diffDays === 0 ? "Hari ini" : (diffDays > 0 ? `Dalam ${diffDays} hari` : `${Math.abs(diffDays)} hari yang lalu`);

    if (filterHoliday.checked && holidays[selectedDateStr]) {
      // Tanggal merah: tampilkan deskripsi + selisih hari
      holidayDesc.style.display = "block";
      holidayDesc.classList.add("holiday-glow", "animate-desc");
      holidayDesc.innerHTML = `
        <div class="desc-holiday">${holidays[selectedDateStr]}</div>
        <div class="desc-diff">Tanggal: ${formatDateDMY(selectedDateStr)}</div>
        <div class="desc-diff">(${diffText})</div>
      `;
    } else {
      // Bukan tanggal merah: hanya tampilkan selisih hari
      holidayDesc.style.display = "block";
      holidayDesc.classList.remove("holiday-glow");
      holidayDesc.classList.add("animate-desc");
      holidayDesc.innerHTML = `
        <div class="desc-diff">Tanggal: ${formatDateDMY(selectedDateStr)}</div>
        <div class="desc-diff">(${diffText})</div>
      `;
    }
  }

  async function checkAndRender() {
    const year = currentDate.getFullYear();
    if (holidays._year !== year) {
      await fetchHolidays(year);
    }
    renderCalendar();
    updateHolidayDescription();
  }

  document.getElementById("prevMonth").onclick = () => { currentDate.setMonth(currentDate.getMonth() - 1); checkAndRender(); };
  document.getElementById("nextMonth").onclick = () => { currentDate.setMonth(currentDate.getMonth() + 1); checkAndRender(); };
  document.getElementById("goYearBtn").onclick = () => { 
    const y = parseInt(document.getElementById("yearInput").value); 
    if (y >= 1900 && y <= 2100) { 
      currentDate.setFullYear(y); 
      currentDate.setMonth(0); 
      checkAndRender(); 
    } 
  };
  document.getElementById("resetBtn").onclick = () => { currentDate = new Date(); checkAndRender(); };

  // Swipe gesture for mobile
  let touchStartX=0,touchEndX=0;
  calendarGrid.addEventListener("touchstart", e => touchStartX = e.changedTouches[0].screenX);
  calendarGrid.addEventListener("touchend", e => { 
    touchEndX = e.changedTouches[0].screenX; 
    if (touchEndX - touchStartX > 40) document.getElementById("prevMonth").click(); 
    if (touchEndX - touchStartX < -40) document.getElementById("nextMonth").click(); 
  });

  // Hamburger menu toggle
  menuToggle.addEventListener("click", () => {
    const open = menuPanel.classList.toggle("open");
    menuToggle.classList.toggle("open", open);
    menuToggle.setAttribute("aria-expanded", open);
    menuPanel.setAttribute("aria-hidden", !open);
  });

  // Filters change
  filterHoliday.addEventListener("change", () => {
    renderCalendar();
    updateHolidayDescription();
  });
  filterManual.addEventListener("change", () => {
    renderCalendar();
    updateHolidayDescription();
  });

  // Theme change
  function applyTheme(theme) {
    document.body.classList.remove("theme-blue", "theme-green", "theme-purple");
    document.body.classList.add(theme);
  }
  themeSelect.addEventListener("change", e => {
    applyTheme(e.target.value);
  });

  // apply theme CSS variables
  const style = document.createElement('style');
  style.textContent = `
    body.theme-blue {
      --accent-color: #90caf9;
      --holiday-color: #ff8a80;
      --neon-green: #39ff14;
      background-color: #121212;
      color: #fff;
    }
    body.theme-green {
      --accent-color: #80c99b;
      --holiday-color: #d46a6a;
      --neon-green: #00ff44;
      background-color: #121212;
      color: #fff;
    }
    body.theme-purple {
      --accent-color: #b07de8;
      --holiday-color: #e87db0;
      --neon-green: #bbff00;
      background-color: #121212;
      color: #fff;
    }
  `;
  document.head.appendChild(style);
  applyTheme(themeSelect.value);

  // Add manual event modal open
  addEventBtn.addEventListener("click", () => {
    eventModal.classList.add("active");
    eventForm.eventDate.value = selectedDateStr || new Date().toISOString().slice(0,10);
    eventForm.eventTitle.value = "";
    eventForm.eventDesc.value = "";
  });

  // Close modal
  eventModal.querySelector(".close-btn").addEventListener("click", () => {
    eventModal.classList.remove("active");
  });
  eventModal.addEventListener("click", e => {
    if (e.target === eventModal) eventModal.classList.remove("active");
  });

  // Save manual event
  eventForm.addEventListener("submit", e => {
    e.preventDefault();
    const date = eventForm.eventDate.value;
    const title = eventForm.eventTitle.value.trim();
    const desc = eventForm.eventDesc.value.trim();

    if (!date || !title) {
      showToast("Tanggal dan Judul wajib diisi.");
      return;
    }
    manualEvents[date] = { title, desc };
    eventModal.classList.remove("active");
    showToast(`Event "${title}" disimpan pada ${formatDateDMY(date)}.`);

    renderCalendar();
    updateHolidayDescription();
  });

  // Toast helper
  function showToast(msg) {
    toast.textContent = msg;
    toast.classList.add("show");
    setTimeout(() => {
      toast.classList.remove("show");
    }, 2500);
  }

  (async function init() {
    await checkAndRender();
  })();
</script>

</body>
</html>
